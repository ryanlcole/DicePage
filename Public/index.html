<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Shaelvien DiceMall</title>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;}
  canvas{display:block;}
</style>
</head>
<body>
<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";
import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js";

const scene = new THREE.Scene();
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
renderer.outputColorSpace = THREE.SRGBColorSpace;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.15;
document.body.appendChild(renderer.domElement);

const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0, 0, 6);
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.enablePan = false;
controls.minDistance = 3;
controls.maxDistance = 12;

/* ---- Procedural galaxy background ---- */
const starTexture = (() => {
  const c = document.createElement("canvas"), s = 1024;
  c.width = c.height = s;
  const ctx = c.getContext("2d");
  const g = ctx.createRadialGradient(s/2, s/2, s*0.05, s/2, s/2, s*0.5);
  g.addColorStop(0, "#050510"); g.addColorStop(1, "#000");
  ctx.fillStyle = g; ctx.fillRect(0,0,s,s);
  for(let i=0;i<1800;i++){
    const x = Math.random()*s, y=Math.random()*s;
    const r = Math.random()<0.98?Math.random()*0.8:Math.random()*1.5;
    ctx.fillStyle = `hsla(${180+Math.random()*120},100%,${80+Math.random()*20}%,${0.6+Math.random()*0.4})`;
    ctx.beginPath(); ctx.arc(x,y,r,0,6.283); ctx.fill();
  }
  const t = new THREE.CanvasTexture(c);
  t.mapping = THREE.EquirectangularReflectionMapping;
  t.colorSpace = THREE.SRGBColorSpace;
  return t;
})();
scene.background = starTexture;
scene.environment = starTexture;

/* ---- Lighting ---- */
const sun = new THREE.DirectionalLight(0xffffff, 2);
sun.position.set(3, 2, 3);
scene.add(sun, new THREE.AmbientLight(0x404040, 0.3));

/* ---- D20 geometry ---- */
const geo = new THREE.IcosahedronGeometry(1.6, 0);

/* ---- Ultra-compact refraction shader ---- */
const mat = new THREE.MeshPhysicalMaterial({
  color: 0xffffff,
  metalness: 0,
  roughness: 0.03,
  transmission: 1,
  thickness: 0.3,
  ior: 2.417,
  envMapIntensity: 1.2,
  clearcoat: 1,
  clearcoatRoughness: 0.03,
  sheen: 0.25,
  sheenRoughness: 0.5,
  side: THREE.DoubleSide
});
const d20 = new THREE.Mesh(geo, mat);
scene.add(d20);

/* ---- Engraved numbers (elemental shimmer) ---- */
const numberShader = {
  uniforms: { t: {value:0}, id:{value:0} },
  vertexShader:`varying vec3 vP;void main(){vP=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}`,
  fragmentShader:`
  uniform float t;uniform float id;varying vec3 vP;
  float n(vec3 p){return fract(sin(dot(p,vec3(12.9898,78.233,45.164)))*43758.5453);}
  void main(){
    float f = abs(vP.z)*5.0+sin(t*2.0+id)*0.5;
    float a = smoothstep(0.45,0.47,fract(f));
    vec3 col = mix(vec3(0.2,0.6,1.0),vec3(1.0,0.9,0.5),sin(t*0.5+id));
    gl_FragColor = vec4(col, a*0.6);
  }`
};
const planes = [];
for(let i=0;i<geo.index.count;i+=3){
  const sub = new THREE.Mesh(
    new THREE.PlaneGeometry(0.9,0.9),
    new THREE.ShaderMaterial({...numberShader,transparent:true})
  );
  sub.material.uniforms.id.value = i;
  const a = new THREE.Vector3(),b=new THREE.Vector3(),c=new THREE.Vector3();
  a.fromBufferAttribute(geo.getAttribute("position"), geo.index.array[i]);
  b.fromBufferAttribute(geo.getAttribute("position"), geo.index.array[i+1]);
  c.fromBufferAttribute(geo.getAttribute("position"), geo.index.array[i+2]);
  const n = new THREE.Vector3().crossVectors(
    new THREE.Vector3().subVectors(b,a),
    new THREE.Vector3().subVectors(c,a)
  ).normalize();
  const center = new THREE.Vector3().add(a).add(b).add(c).multiplyScalar(1/3);
  sub.position.copy(center.addScaledVector(n,-0.02));
  sub.lookAt(center.clone().add(n));
  planes.push(sub); d20.add(sub);
}

/* ---- Animate ---- */
let t=0;
function animate(){
  requestAnimationFrame(animate);
  t+=0.016;
  sun.position.set(Math.cos(t*0.3)*3, 2, Math.sin(t*0.3)*3);
  planes.forEach(p=>p.material.uniforms.t.value=t);
  d20.rotation.y += 0.002;
  d20.rotation.x += 0.001;
  controls.update();
  renderer.render(scene,camera);
}
animate();

/* ---- Resize ---- */
addEventListener("resize",()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>



