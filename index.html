// === Hex-sphere geometry ===
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";

function buildHexSphere(radius = 1, divs = 4) {
  // Start from an icosahedron (20 triangles)
  const ico = new THREE.IcosahedronGeometry(radius, divs);
  const verts = ico.attributes.position.array;
  const cells = [];

  // --- Project to sphere ---
  for (let i = 0; i < verts.length; i += 3) {
    const v = new THREE.Vector3(verts[i], verts[i + 1], verts[i + 2]).normalize().multiplyScalar(radius);
    verts[i] = v.x; verts[i + 1] = v.y; verts[i + 2] = v.z;
  }

  // --- Hex remeshing (dualization) ---
  // Each vertex of the icosahedron becomes the center of a pentagon,
  // and the rest approximate hexes.  We’ll make a topological map for now.
  const pos = ico.attributes.position;
  const geo = new THREE.PolyhedronGeometry(ico.parameters.vertices, ico.parameters.indices, radius, 0);
  geo.computeVertexNormals();

  // Store a “faceId” attribute like before for coloring later
  const faceId = [];
  for (let i = 0; i < geo.index.count / 3; i++) {
    faceId.push(i, i, i);
  }
  geo.setAttribute("faceId", new THREE.BufferAttribute(new Float32Array(faceId), 1));

  return geo;
}

// === Replace D20 mesh ===
const geometry = buildHexSphere(1.5, 2);
const material = new THREE.MeshPhysicalMaterial({
  color: 0x99ddff,
  roughness: 0.2,
  metalness: 0.1,
  transmission: 0.6,
  ior: 1.6,
  thickness: 0.8,
  clearcoat: 1.0
});
const hexSphere = new THREE.Mesh(geometry, material);
scene.add(hexSphere);


<!-- Mirror Build Wed Oct  8 15:24:47 UTC 2025 -->
